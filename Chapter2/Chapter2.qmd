---
title: "Model Exploration"
---

```{r load-pkg}

library(tidyverse)
library(tidymodels)
library(lme4)
library(MASS)
library(car)
library(MuMIn)
library(lmerTest)
library(ggplot2)
library(dplyr)

# load gardnerjanson_museums
gardnerjanson_museums <- read_csv("gardnerjanson_museums.csv")
```

# Model Exploration:

```{r model}
lmm_model <- lmer(log(space_ratio_per_page_total) ~ artist_race
                       + artist_ethnicity 
                       + artist_gender 
                       + artist_nationality_other
                       + moma_count_to_date
                       + whitney_count_to_date
                       + (1 | artist_name),
            data = gardnerjanson_museums %>% filter(book == "janson"),
    REML = FALSE)
summary(lmm_model)
```

```{r AICnewmodel}
newmodel <- step(lmm_model)
```

the multiple of the number of degrees of freedom used for the penalty.
Only k = 2 gives the genuine AIC: k = log(n) is sometimes referred to as BIC or SBC.

```{r}
knitr::knit_exit()
```

```{r BICnewmodel}
n <- nrow(gardnerjanson_museums)

newmodel<- stepAIC(lmm_model, k = log(n), scope=list(upper= ~artist_gender*artist_race*artist_nationality_other*artist_ethnicity*moma_count_to_date*whitney_count_to_date*year, lower= ~1))

```

```{r lowestAIC}
lmm_model <- lmer(log(space_ratio_per_page_total) ~ artist_race
                       + artist_ethnicity 
                       + artist_gender 
                       + artist_nationality_other
                       + moma_count_to_date
                       + whitney_count_to_date
                       + artist_gender*moma_count_to_date
                       + artist_gender*artist_nationality_other
                       + artist_nationality_other*moma_count_to_date +
                         (1 | artist_name),
            data = gardnerjanson_museums,
    REML = FALSE)
summary(lmm_model)

```

```{r}

```

```{r collinearity}
vif(lmm_model)
```

GET PVALUES FOR COEFFICIENTS - STATISTICALLY SIGNIFICANT - GO THROUGH INTERPRETATIONS WITH LOG TRANSFORMATION AND MIXED EFFECTS MODEL - CONFIRM MODEL DIAGNOSTICS - AIC / BIC FOR MIXED EFFECTS -

```{r lmerTest}

summary(lmm_model, ddf = "Satterthwaite")

```

```{r rsq}
r.squaredGLMM(lmm_model)
```

Marginal R2 provides the variance explained only by fixed effects and conditional R2 provides the variance explained by the entire model, i.e., both fixed effects and random effects.

```{r}
#create vector of VIF values
#vif_values <- vif(lmm_model)$`GVIF^(1/(2*Df))`

#create horizontal bar chart to display each VIF value
#barplot(vif_values, main = "VIF Values", horiz = TRUE, col = "steelblue")

#add vertical line at 5
#abline(v = 5, lwd = 3, lty = 2)
```

Model Diagnostics : Check for linearity, independence, residuals, normal distribution of the residuals - no pattern in residuals, constant variance

RESOURCE: https://www.ssc.wisc.edu/sscc/pubs/MM/MM_DiagInfer.html

Plotting : log transform some variables : Fitted v. Residuals

```{r diagnostics}

plot(resid(lmm_model, type = "pearson") ~ fitted(lmm_model))
```

before log transforming our outcome variable, the constant variance assumption was violated.
Therefore, in order to pass the constant variance assumption, I performed a log transformation.

```{r normal}

qqnorm(resid(lmm_model, type = "pearson"))
qqline(resid(lmm_model, type = "pearson"))

```

Linearity:

```{r linearitymoma}

ggplot(gardnerjanson_museums, aes(x = moma_count_to_date, y = log(space_ratio_per_page_total))) +
  geom_point(position=position_jitter(h=0.1, w=0.1), alpha = 0.5, size = 1) +
  geom_smooth(method = "lm", se = FALSE)+
  labs(
    title = "Log of 
    Ratio of Space Per Artist Per Edition by\nNumber of Exhibitions per Artist per Editions in the MoMA",
    x = "Count to Date",
    y = "Ratio of Space Per Artist Per Edition"
  )
```

```{r linearitywhitney}

ggplot(gardnerjanson_museums, aes(x = whitney_count_to_date, y = log(space_ratio_per_page_total))) +
  geom_point(position=position_jitter(h=0.1, w=0.1), alpha = 0.5, size = 1) +
  geom_smooth(method = "lm", se = FALSE)+
  labs(
    title = "Log of Ratio of Space Per Artist Per Edition by\nNumber of Exhibitions per Artist per Editions in the Whitney",
    x = "Count to Date",
    y = "Ratio of Space Per Artist Per Edition"
  )
```

Normality of random effect: Get the estimate of random effect (in your case random intercepts), and check them as check the residual.
But it is not efficient because you just have 7 random intercepts.

Another assumption is the independent between subjects.
No test, based on your judgement.
Subject specific random intercept means the correlation between the response variable from the same subject are the same.

all obervations of different artists are independent -

log transforming predictors - interpretations change - variables weren't changed - same idea, bit different

INDEPENDENCE: DOUBLE CHECK - EMPIRICALLY ARGUE OR ?

verbally argue the independence between artists - since we are using a mixed effects model, and our random effect is per artist, we eliminate the dependence of our observations had we not used a mixed effects model.
Between artists, we expect the observations to be independent.

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```

```{r}

```
