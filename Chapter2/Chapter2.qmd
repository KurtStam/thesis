---
title: "Model Exploration"
---

```{r load-pkg}

library(tidyverse)
library(tidymodels)
library(lme4)
library(MASS)
library(car)
library(MuMIn)
library(lmerTest)
library(ggplot2)
library(dplyr)
library(broom.mixed)
library(forcats)
library(sjPlot)

# load gardnerjanson_museums
gardnerjanson_museums <- read_csv("gardnerjanson_museums.csv")
```

# Data Preparation for Modeling:

```{r}
#| label: lmm_prep
#| echo: false

gardnerjanson_museums <- gardnerjanson_museums %>%
  filter(!startsWith(artist_name, "N/A"))%>%
  mutate(artist_race_nwi = if_else(artist_race == "White", "White", "Non-White")) %>%
  mutate(artist_nationality_other = fct_relevel(artist_nationality_other, c("American", 
                                                                            "French", 
                                                                            "Other", 
                                                                            "British", 
                                                                            "German", 
                                                                            "Spanish")), 
         artist_race_nwi = fct_relevel(artist_race_nwi, c("White", "Non-White")),
         artist_ethnicity = fct_relevel(artist_ethnicity, c("Not Hispanic or Latinx",
                                                            "Hispanic or Latinx")),
         artist_gender = fct_relevel(artist_gender, c("Male", "Female")))

```

```{r}
#| label: nationality_tally
#| echo: false
gardnerjanson_museums%>%
   group_by(artist_nationality_other) %>%
   tally()
```

# Model Exploration:

```{r}
#| label: lmm_full
#| echo: false

lmm_full <- lmer(log(space_ratio_per_page_total) ~ artist_race_nwi
                       + artist_ethnicity 
                       + artist_gender 
                       + artist_nationality_other
                       + moma_count_to_date
                       + whitney_count_to_date +
                         (1 | artist_name),
            data = gardnerjanson_museums,
    REML = FALSE)
```

    ddf="Satterthwaite"

Satterthwaite test, more flexible, looking directly at p-values - non-parametric test - uses different error term, similar to a two same t-test, similar to ANOVA - analysis of variance - checking between different groups -

```{r}
#| label: lmm_test
#| echo: false

lmm <- lmer(log(space_ratio_per_page_total) ~ artist_race_nwi
                       + artist_ethnicity 
                       + artist_gender 
                       + artist_nationality_other
                       + moma_count_to_date
                       + whitney_count_to_date
                       + artist_nationality_other*moma_count_to_date
                       + artist_race_nwi*moma_count_to_date
                       + artist_ethnicity*moma_count_to_date
                       + artist_race_nwi*whitney_count_to_date
                       + artist_ethnicity*whitney_count_to_date
                  + (1 | artist_name),
            data = gardnerjanson_museums,
    REML = FALSE)
```

```{r}
#| label: lmm_step
#| echo: false

lmerTest::step(lmm)
```

pick a handful of interest

visualization : confidence intervals for each on of the slopes

predictors on the y axis -

bar plots of the pvalues another option

nationality discourse for significance

log transformation on the y variable -

stepwise model selection

the multiple of the number of degrees of freedom used for the penalty. Only k = 2 gives the genuine AIC: k = log(n) is sometimes referred to as BIC or SBC.

```{r}
#| label: lmm
#| echo: false

lmm <- lmer(log(space_ratio_per_page_total) ~ artist_nationality_other
                       + moma_count_to_date
                       + artist_nationality_other*moma_count_to_date
                        + (1 | artist_name),
            data = gardnerjanson_museums,
    REML = FALSE)
summary(lmm)
```

```{r}
#| label: sjplot
#| echo: false

sjPlot::plot_model(lmm, 
                   axis.labels=c("Spanish x MoMA Count to Date",
                                 "German x MoMA Count to Date",
                                 "British x MoMA Count to Date",
                                 "Other x MoMA Count to Date", 
                                 "French x MoMA Count to Date",
                                 "MoMA Count to Date",
                                 "Spanish",
                                 "German",
                                 "British",
                                 "Nationality Other",
                                 "French"),
                   show.values=TRUE, show.p=TRUE,
                   title="Effect of Artist Nationality and the Number of Exhibitions Held at the MoMA per Artist per Edition on the Total Space Ratio per Page")
```

```{r}
#| label: collinearity
#| echo: false

vif(lmm)
```

GET PVALUES FOR COEFFICIENTS - STATISTICALLY SIGNIFICANT - GO THROUGH INTERPRETATIONS WITH LOG TRANSFORMATION AND MIXED EFFECTS MODEL - CONFIRM MODEL DIAGNOSTICS - AIC / BIC FOR MIXED EFFECTS -

```{r rsq}
r.squaredGLMM(lmm)
```

Marginal R2 provides the variance explained only by fixed effects and conditional R2 provides the variance explained by the entire model, i.e., both fixed effects and random effects.

Model Diagnostics : Check for linearity, independence, residuals, normal distribution of the residuals - no pattern in residuals, constant variance

RESOURCE: https://www.ssc.wisc.edu/sscc/pubs/MM/MM_DiagInfer.html

Plotting : log transform some variables : Fitted v. Residuals

# Appendix:

## Assumptions:

### Residuals and Constant Variance:

```{r diagnostics}

plot(resid(lmm, type = "pearson") ~ fitted(lmm))
```

for the very low values of the predicted have very low variability for residuals - the rest varied

the a bulk of the data there is constant variability in the residuals

before log transforming our outcome variable, the constant variance assumption was violated. Therefore, in order to pass the constant variance assumption, I performed a log transformation.

### Normality:

normal histogram = density plot overlayed -

Struggling to understand how to do this with a mixed-effects model

```{r}
#| label: density-histogram

#lmm_aug <- augment(lmm$fit)

#ggplot(lmm_model_aug, aes(x = .resid))+
 # geom_histogram(binwidth = 50, aes(y = after_stat(density)))+
 # theme_minimal()+ 
 # stat_function(fun = dnorm,
  #              args = list(mean = mean(lmm_model_aug$.resid),
  #                          sd = sd(lmm_model_aug$.resid)),
  #              color = "red",
  #              size = 2)
```

```{r normal}

qqnorm(resid(lmm, type = "pearson"))
qqline(resid(lmm, type = "pearson"))
```

### Linearity:

residuals v quantitative predictors

once i figure out how to augment the data and get the .resid I can make this visualization as well

no pattern is left behind

```{r linearitymoma}

ggplot(gardnerjanson_museums, aes(x = moma_count_to_date, y = log(space_ratio_per_page_total))) +
  geom_point(position=position_jitter(h=0.1, w=0.1), alpha = 0.5, size = 1) +
  geom_smooth(method = "lm", se = FALSE)+
  labs(
    title = "Log of 
    Ratio of Space Per Artist Per Edition by\nNumber of Exhibitions per Artist per Editions in the MoMA",
    x = "Count to Date",
    y = "Ratio of Space Per Artist Per Edition"
  )
```

```{r linearitywhitney}

ggplot(gardnerjanson_museums, aes(x = whitney_count_to_date, y = log(space_ratio_per_page_total))) +
  geom_point(position=position_jitter(h=0.1, w=0.1), alpha = 0.5, size = 1) +
  geom_smooth(method = "lm", se = FALSE)+
  labs(
    title = "Log of Ratio of Space Per Artist Per Edition by\nNumber of Exhibitions per Artist per Editions in the Whitney",
    x = "Count to Date",
    y = "Ratio of Space Per Artist Per Edition"
  )
```

Normality of random effect: Get the estimate of random effect (in your case random intercepts), and check them as check the residual. But it is not efficient because you just have 7 random intercepts.

### Independence:

Another assumption is the independence between subjects. No test, based on your judgement. Subject specific random intercept means the correlation between the response variable from the same subject are the same.

all obervations of different artists are independent -

fitting a mixed model - i do not believe that pieces by each artist is independence - at the artist level we have independence

log transforming predictors - interpretations change - variables weren't changed - same idea, bit different

INDEPENDENCE: DOUBLE CHECK - EMPIRICALLY ARGUE OR ?

check for time series - residuals v. order of data points

irrelevant - based on how the sample was collected.

verbally argue the independence between artists - since we are using a mixed effects model, and our random effect is per artist, we eliminate the dependence of our observations had we not used a mixed effects model. Between artists, we expect the observations to be independent.

## **Data Dictionary:**

Outcome:

`space_ratio_per_page_total` = The area in centimeters squared of both the text and the figure of a particular artist in a given edition of *Janson's History of Art* divided by the area in centimeters squared of a single page of the respective edition.

Potential Predictors:

`artist_gender` = The gender of the artist.

`artist_race` = The race of the artist.

`artist_race_nwi` = The non-white indicator for artist race, meaning if an artist's race is denoted as either white or non-white.

`artist_ethnicity` = The ethnicity of the artist.

`artist_nationality_other` = The nationality of the artist. Roughly 80% of of the total count of artists through all editions of Janson account for French, Spanish, British, American and German. Therefore, the categorical strings of this variable are French, Spanish, British, American, German and Other.

`whitney_count_to_date` = The count of exhibitions held by The Whitney of a particular artist at a particular moment of time, as highlighted by `year`.

`moma_count_to_date` = The count of exhibitions held by the Museum of Modern Art (MoMA) of a particular artist at a particular moment of time, as highlighted by `year`.

`year` = The year of publication for a given edition of Janson or Gardner.

Other variables:

`edition_number` = The edition number of the textbook from either Janson's History of Art or Gardner's Art Through the Ages.

`book` = Which book, either Janson or Gardner the particular artist at that particular time was included.

`artist_unique_id` = A unique identifying number assigned to artists across books and editions denoted in alphabetical order.
